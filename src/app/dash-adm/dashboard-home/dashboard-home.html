<!-- Dashboard Home Template -->
<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Error Loading Dashboard</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="refreshData()">Retry</button>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!isLoading && !error" class="dashboard-content">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1 class="welcome-title">Welcome to Your Dashboard</h1>
        <p class="welcome-subtitle">Here's what's happening with your business today</p>
        <div class="welcome-stats">
          <div class="welcome-stat">
            <span class="stat-number">{{ formatNumber(dashboardStats?.users?.total || 0) }}</span>
            <span class="stat-label">Total Users</span>
          </div>
          <div class="welcome-stat">
            <span class="stat-number">{{ formatNumber(dashboardStats?.products?.total || 0) }}</span>
            <span class="stat-label">Products</span>
          </div>
          <div class="welcome-stat">
            <span class="stat-number">{{ formatCurrency(dashboardStats?.sales?.total || 0) }}</span>
            <span class="stat-label">Total Sales</span>
          </div>
        </div>
      </div>
      <div class="refresh-section">
        <button class="refresh-btn" (click)="refreshData()">
          üîÑ Refresh Data
        </button>
      </div>
    </div>

    <!-- Grace Period Stats -->
    <app-grace-period-stats></app-grace-period-stats>

    <!-- Main Stats Grid -->
    <div class="stats-grid">
      <!-- Users Card -->
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon">üë•</div>
          <div class="stat-info">
            <h3>Users</h3>
            <p class="stat-number">{{ formatNumber(dashboardStats?.users?.total || 0) }}</p>
            <span class="stat-growth positive">{{ dashboardStats?.users?.growth }}</span>
          </div>
        </div>
        <div class="stat-details">
          <div class="recent-items">
            <h4>Recent Users</h4>
            <div *ngFor="let user of dashboardStats?.users?.recent?.slice(0, 3)" class="recent-item">
              <span class="item-name">{{ user.name }}</span>
              <span class="item-date">{{ formatDate(user.createdAt) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Card -->
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon">üì¶</div>
          <div class="stat-info">
            <h3>Products</h3>
            <p class="stat-number">{{ formatNumber(dashboardStats?.products?.total || 0) }}</p>
            <span class="stat-growth positive">{{ dashboardStats?.products?.growth }}</span>
          </div>
        </div>
        <div class="stat-details">
          <div class="recent-items">
            <h4>Recent Products</h4>
            <div *ngFor="let product of dashboardStats?.products?.recent?.slice(0, 3)" class="recent-item">
              <span class="item-name">{{ product.name }}</span>
              <span class="item-price">{{ formatCurrency(product.price) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Card -->
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon">üí∞</div>
          <div class="stat-info">
            <h3>Sales</h3>
            <p class="stat-number">{{ formatCurrency(dashboardStats?.sales?.total || 0) }}</p>
            <span class="stat-growth positive">{{ dashboardStats?.sales?.growth }}</span>
          </div>
        </div>
        <div class="stat-details">
          <div class="recent-items">
            <h4>Recent Sales</h4>
            <div *ngFor="let sale of dashboardStats?.sales?.recent?.slice(0, 3)" class="recent-item">
              <span class="item-name">{{ sale.product?.name || 'Product' }}</span>
              <span class="item-price">{{ formatCurrency(sale.amount) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Subscriptions Card -->
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon">üìã</div>
          <div class="stat-info">
            <h3>Active Subscriptions</h3>
            <p class="stat-number">{{ formatNumber(dashboardStats?.subscriptions?.active || 0) }}</p>
            <span class="stat-label">Active Plans</span>
          </div>
        </div>
        <div class="stat-details">
          <div class="subscription-info">
            <div class="info-item">
              <span class="label">Total Suppliers:</span>
              <span class="value">{{ formatNumber(dashboardStats?.suppliers?.total || 0) }}</span>
            </div>
            <div class="info-item">
              <span class="label">Categories:</span>
              <span class="value">{{ formatNumber(dashboardStats?.categories?.total || 0) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Revenue Analytics Section -->
    <div class="analytics-section">
      <div class="section-header">
        <h2>Revenue Analytics</h2>
        <div class="period-selector">
          <button 
            *ngFor="let period of ['week', 'month', 'year']" 
            [class.active]="selectedPeriod === period"
            (click)="onPeriodChange(period)"
            class="period-btn">
            {{ period | titlecase }}
          </button>
        </div>
      </div>
      
      <div class="revenue-chart">
        <div *ngIf="revenueStats.length > 0" class="chart-container">
          <div *ngFor="let stat of revenueStats.slice(0, 7)" class="chart-bar">
            <div class="bar" [style.height.%]="(stat.total / getMaxRevenue()) * 100"></div>
            <span class="bar-label">{{ formatCurrency(stat.total) }}</span>
          </div>
        </div>
        <div *ngIf="revenueStats.length === 0" class="no-data">
          <p>No revenue data available for this period</p>
        </div>
      </div>
    </div>

    <!-- Top Performers Section -->
    <div class="performers-section">
      <div class="performers-grid">
        <!-- Top Products -->
        <div class="performer-card">
          <div class="card-header">
            <h3>üèÜ Top Products</h3>
          </div>
          <div class="performer-list">
            <div *ngFor="let product of topProducts.slice(0, 5); let i = index" class="performer-item">
              <div class="rank">{{ i + 1 }}</div>
              <div class="performer-info">
                <span class="name">{{ product.name }}</span>
                <span class="details">{{ formatCurrency(product.totalSales) }}</span>
              </div>
              <div class="performer-stats">
                <span class="orders">{{ product.totalOrders }} orders</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Top Suppliers -->
        <div class="performer-card">
          <div class="card-header">
            <h3>üèÜ Top Suppliers</h3>
          </div>
          <div class="performer-list">
            <div *ngFor="let supplier of topSuppliers.slice(0, 5); let i = index" class="performer-item">
              <div class="rank">{{ i + 1 }}</div>
              <div class="performer-info">
                <span class="name">{{ supplier.name }}</span>
                <span class="details">{{ supplier.email }}</span>
              </div>
              <div class="performer-stats">
                <span class="products">{{ supplier.productCount }} products</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Activity Feed Section -->
    <div class="activity-section">
      <div class="section-header">
        <h2>üìä Recent Activity</h2>
      </div>
      <div class="activity-feed">
        <div *ngFor="let activity of activityFeed.slice(0, 8)" class="activity-item">
          <div class="activity-icon">{{ getActivityIcon(activity.type) }}</div>
          <div class="activity-content">
            <h4>{{ activity.title }}</h4>
            <p>{{ activity.description }}</p>
            <span class="activity-time">{{ formatDate(activity.timestamp) }}</span>
          </div>
        </div>
        <div *ngIf="activityFeed.length === 0" class="no-activity">
          <p>No recent activity</p>
        </div>
      </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="quick-actions-section">
      <div class="section-header">
        <h2>‚ö° Quick Actions</h2>
      </div>
      <div class="actions-grid">
        <a routerLink="/dash-adm/products/add-product" class="action-card">
          <div class="action-icon">‚ûï</div>
          <h3>Add Product</h3>
          <p>Create a new product</p>
        </a>
        <a routerLink="/dash-adm/users/add" class="action-card">
          <div class="action-icon">üë§</div>
          <h3>Add User</h3>
          <p>Create a new user account</p>
        </a>
        <a routerLink="/dash-adm/suppliers/add" class="action-card">
          <div class="action-icon">üè¢</div>
          <h3>Add Supplier</h3>
          <p>Register a new supplier</p>
        </a>
        <a routerLink="/dash-adm/subscriptions/create" class="action-card">
          <div class="action-icon">üìã</div>
          <h3>Create Subscription</h3>
          <p>Set up a new subscription</p>
        </a>
      </div>
    </div>
  </div>
</div> 