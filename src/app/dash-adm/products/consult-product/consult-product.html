<div class="consult-product-container" *ngIf="product">
  <div class="product-header">
    <img *ngIf="product.image" [src]="product.image" alt="Product Image" class="product-header-img" />
    <div class="product-header-info">
      <h2>{{ product.name }} <span *ngIf="product.promotion" class="badge-promo">Promo</span></h2>
      <div class="product-header-meta">
        <span class="product-ref">Ref: {{ product.reference }}</span>
        <span class="product-category">{{ product.category }}<ng-container *ngIf="product.subCategory"> &rsaquo; {{ product.subCategory }}</ng-container></span>
        <span class="product-supplier">Supplier: {{ getSupplierName(product.supplier) }}</span>
      </div>
      <div class="product-header-rating">
        <ng-container *ngFor="let star of [1,2,3,4,5]; let i = index">
          <span class="star" [class.filled]="product.rate && product.rate >= star">&#9733;</span>
        </ng-container>
        <span class="rate-value">{{ product.rate || 0 }}/5</span>
      </div>
    </div>
  </div>
  <hr class="product-separator" />
  <div class="product-main-horizontal">
    <div class="product-visuals">
      <app-three-viewer [modelUrl]="model3DUrl"></app-three-viewer>
    </div>
    <div class="product-main-info">
      <div class="product-info-card">
        <div class="product-info-row">
          <span class="product-info-label">Price</span>
          <span class="product-info-value price">{{ product.price | currency }}</span>
        </div>
        <div class="product-info-row">
          <span class="product-info-label">Sales</span>
          <span class="product-info-value">{{ product.sales }}</span>
        </div>
        <div class="product-info-row" *ngIf="product.description">
          <span class="product-info-label">Description</span>
          <span class="product-info-value">{{ product.description }}</span>
        </div>
        <div class="product-info-row" *ngIf="product.dimensions">
          <span class="product-info-label">Dimensions</span>
          <span class="product-info-value">
            <ng-container *ngIf="product.dimensions.height">H: <b>{{ product.dimensions.height }}</b> </ng-container>
            <ng-container *ngIf="product.dimensions.width">W: <b>{{ product.dimensions.width }}</b> </ng-container>
            <ng-container *ngIf="product.dimensions.length">L: <b>{{ product.dimensions.length }}</b> </ng-container>
            <ng-container *ngIf="product.dimensions.radius">R: <b>{{ product.dimensions.radius }}</b></ng-container>
          </span>
        </div>
      </div>
    </div>
  </div>
  <hr class="product-separator" />
  <section class="product-reviews-section">
    <h3>Reviews</h3>
    <form (ngSubmit)="submitReview()" #reviewForm="ngForm" class="review-form">
      <textarea [(ngModel)]="newReview.comment" name="comment" placeholder="Add a review..." required ngModel></textarea>
      <input type="file" (change)="onReviewImageChange($event)" />
      <button type="submit" [disabled]="isReviewSubmitting || !newReview.comment">Submit</button>
    </form>
    <div *ngIf="isReviewLoading">Loading reviews...</div>
    <ul class="review-list">
      <li *ngFor="let review of reviews">
        <div class="review-header">
          <span class="review-user">{{ review.user }}</span>
          <span class="review-date">{{ review.createdAt | date:'short' }}</span>
        </div>
        <div class="review-body">
          <span>{{ review.comment }}</span>
          <img *ngIf="review.image" [src]="review.image" class="review-image" />
        </div>
        <div class="review-actions">
          <button (click)="editReview(review)">Edit</button>
          <button (click)="deleteReview(review)">Delete</button>
          <input type="file" (change)="onReviewImageUpload($event, review)" />
        </div>
      </li>
    </ul>
  </section>
  <hr class="product-separator" />
  <app-upload-3d [product3DId]="product3DId"></app-upload-3d>
  <button class="back-btn" (click)="goBack()">
    <span class="back-icon">&#8592;</span> Back to List
  </button>
</div>
<div *ngIf="isLoading">Loading product...</div>
<div *ngIf="error" class="error">{{ error }}</div>
