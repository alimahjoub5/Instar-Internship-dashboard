<nav class="products-breadcrumb">
  <span routerLink="/dash-fn">Dashboard</span> <span class="breadcrumb-separator">&gt;</span> <span class="breadcrumb-current">Profile</span>
</nav>
  
  <div class="account-settings-container">
    <h1 class="account-settings-title">Account settings</h1>
    
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <mat-icon class="loading-spinner">refresh</mat-icon>
      <p>Loading profile...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
      <mat-icon class="error-icon">warning</mat-icon>
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="refreshProfile()">Try Again</button>
    </div>

    <!-- Account Settings Layout - Only show when no error and not loading -->
    <div *ngIf="!loading && !error" class="account-settings-layout">
      <!-- Left sidebar navigation -->
      <div class="settings-sidebar">
        <div class="settings-nav-item" [class.active]="activeTab === 'profile'" (click)="setActiveTab('profile')">
          <mat-icon>person</mat-icon>
          <span>Profile Settings</span>
        </div>
        <div class="settings-nav-item" [class.active]="activeTab === 'password'" (click)="setActiveTab('password')">
          <mat-icon>lock</mat-icon>
          <span>Password</span>
        </div>
        <div class="settings-nav-item" [class.active]="activeTab === 'notifications'" (click)="setActiveTab('notifications')">
          <mat-icon>notifications</mat-icon>
          <span>Notifications</span>
        </div>
        <div class="settings-nav-item" [class.active]="activeTab === 'verification'" (click)="setActiveTab('verification')">
          <mat-icon>verified_user</mat-icon>
          <span>Verification</span>
        </div>
      </div>
      
      <!-- Main content area -->
      <div class="settings-content">
        <!-- Profile Settings Tab -->
        <div *ngIf="activeTab === 'profile'" class="tab-content">
          <div class="tab-header">
            <h2>Profile Settings</h2>
            <button class="btn-secondary refresh-btn" (click)="refreshProfile()" [disabled]="loading">
              <mat-icon>refresh</mat-icon>
              Refresh
            </button>
          </div>
          <!-- Profile photo section -->
          <div class="profile-photo-section">
            <div class="profile-photo-container">
              <img [src]="supplier.image" alt="Supplier Avatar" class="profile-photo" *ngIf="supplier.image">
              <div class="photo-edit-icon">
                <mat-icon>photo_camera</mat-icon>
              </div>
            </div>
            <div class="photo-actions">
              <button class="btn-primary">Upload New</button>
              <button class="btn-secondary">Delete avatar</button>
            </div>
          </div>
          
          <!-- Profile form -->
          <div class="profile-form">
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">Supplier Name <span class="required">*</span></label>
                <input type="text" id="firstName" class="form-control" [(ngModel)]="supplier.name" required>
              </div>
              <div class="form-group">
                <label for="lastName">Website</label>
                <input type="text" id="lastName" class="form-control" [(ngModel)]="supplier.webSite">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" class="form-control" [(ngModel)]="supplier.email" required>
              </div>
              <div class="form-group">
                <label for="recoveryEmail">Brand/Marque</label>
                <input type="text" id="recoveryEmail" class="form-control" [(ngModel)]="supplier.marque" placeholder="Enter brand/marque (optional)">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="phone">Mobile Number</label>
                <div class="phone-input-group">
                  <div class="country-select">
                    <span class="flag-icon">ðŸ‡³ðŸ‡¬</span>
                    <span class="dropdown-arrow">â–¼</span>
                  </div>
                  <input type="tel" id="phone" class="form-control phone-number" [(ngModel)]="supplier.phone">
                </div>
              </div>
              <div class="form-group">
                <label for="birthDate">RIB</label>
                <input type="text" id="birthDate" class="form-control" [(ngModel)]="supplier.rib">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Subscription Status</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" id="active" name="subscription" value="true" [(ngModel)]="supplier.hasActiveSubscription">
                    <label for="active">Active Subscription</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="inactive" name="subscription" value="false" [(ngModel)]="supplier.hasActiveSubscription">
                    <label for="inactive">No Active Subscription</label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group full-width">
                <label for="address">Address</label>
                <textarea id="address" class="form-control" rows="3" [(ngModel)]="supplier.address" placeholder="Enter your address (optional)"></textarea>
              </div>
            </div>
            
            <div class="form-actions">
              <button class="btn-save" (click)="saveProfileChanges()" [disabled]="loading">
                <mat-icon *ngIf="loading" class="loading-spinner">refresh</mat-icon>
                {{ loading ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </div>
        </div>
        
        <!-- Password Tab -->
        <div *ngIf="activeTab === 'password'" class="tab-content">
          <div class="password-form">
            <h2 class="tab-title">Change Password</h2>
            <p class="tab-description">Update your password to keep your account secure.</p>
            
            <form #passwordForm="ngForm" (ngSubmit)="changePassword()">
              <div class="form-group">
                <label for="currentPassword">Current Password <span class="required">*</span></label>
                <div class="password-input-group">
                  <input 
                    [type]="showCurrentPassword ? 'text' : 'password'" 
                    id="currentPassword" 
                    class="form-control" 
                    [(ngModel)]="passwordData.currentPassword"
                    name="currentPassword"
                    required
                    placeholder="Enter your current password">
                  <button type="button" class="password-toggle" (click)="togglePasswordVisibility('current')">
                    <mat-icon>{{ showCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                  </button>
                </div>
              </div>
              
              <div class="form-group">
                <label for="newPassword">New Password <span class="required">*</span></label>
                <div class="password-input-group">
                  <input 
                    [type]="showNewPassword ? 'text' : 'password'" 
                    id="newPassword" 
                    class="form-control" 
                    [(ngModel)]="passwordData.newPassword"
                    name="newPassword"
                    required
                    minlength="8"
                    placeholder="Enter your new password">
                  <button type="button" class="password-toggle" (click)="togglePasswordVisibility('new')">
                    <mat-icon>{{ showNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                  </button>
                </div>
                <div class="password-requirements">
                  <small>Password must be at least 8 characters long</small>
                </div>
              </div>
              
              <div class="form-group">
                <label for="confirmPassword">Confirm New Password <span class="required">*</span></label>
                <div class="password-input-group">
                  <input 
                    [type]="showConfirmPassword ? 'text' : 'password'" 
                    id="confirmPassword" 
                    class="form-control" 
                    [(ngModel)]="passwordData.confirmPassword"
                    name="confirmPassword"
                    required
                    placeholder="Confirm your new password">
                  <button type="button" class="password-toggle" (click)="togglePasswordVisibility('confirm')">
                    <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                  </button>
                </div>
                <div *ngIf="passwordData.newPassword && passwordData.confirmPassword && passwordData.newPassword !== passwordData.confirmPassword" class="error-message">
                  <small>Passwords do not match</small>
                </div>
              </div>
              
              <div class="form-group">
                <label for="recoveryEmailPassword">Recovery Email <span class="required">*</span></label>
                <input 
                  type="email" 
                  id="recoveryEmailPassword" 
                  class="form-control" 
                  [(ngModel)]="passwordData.recoveryEmail"
                  name="recoveryEmailPassword"
                  required
                  placeholder="Enter your recovery email for verification">
                <div class="field-description">
                  <small>Please enter your recovery email to verify your identity before changing your password</small>
                </div>
              </div>
              
              <div class="form-actions">
                <button type="submit" class="btn-save" [disabled]="!passwordForm.valid || passwordData.newPassword !== passwordData.confirmPassword || loading">
                  <mat-icon *ngIf="loading" class="loading-spinner">refresh</mat-icon>
                  {{ loading ? 'Updating...' : 'Update Password' }}
                </button>
                <button type="button" class="btn-secondary" (click)="resetPasswordForm()" [disabled]="loading">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Notifications Tab -->
        <div *ngIf="activeTab === 'notifications'" class="tab-content">
          <h2 class="tab-title">Notification Settings</h2>
          <p class="tab-description">Manage your notification preferences.</p>
          <!-- Add notification settings here -->
        </div>
        
        <!-- Verification Tab -->
        <div *ngIf="activeTab === 'verification'" class="tab-content">
          <h2 class="tab-title">Account Verification & Subscription</h2>
          <p class="tab-description">Manage your subscription and verify your account for enhanced security.</p>
          
          <!-- Subscription Section -->
          <div class="subscription-section">
            <h3 class="section-title">Subscription Status</h3>
            
            <!-- Loading State -->
            <div *ngIf="subscriptionLoading" class="loading-container">
              <div class="loading-spinner"></div>
              <p>Loading subscription data...</p>
            </div>
            
            <!-- Error State -->
            <div *ngIf="subscriptionError" class="error-container">
              <mat-icon class="error-icon">error</mat-icon>
              <p>{{ subscriptionError }}</p>
              <button class="retry-btn" (click)="loadSubscriptionData()">Retry</button>
            </div>
            
            <!-- User has active subscription -->
            <div *ngIf="!subscriptionLoading && !subscriptionError && hasActiveSubscription" class="current-subscription">
              <h4>Your Current Subscription</h4>
              <div *ngFor="let subscription of userSubscriptions" class="subscription-card">
                <div *ngIf="getSubscriptionStatus(subscription) === 'active' || getSubscriptionStatus(subscription) === 'grace-period'" class="subscription-info">
                  <div class="subscription-header">
                    <h5 class="plan-name">{{ subscription.planType | titlecase }} Plan</h5>
                    <span class="status-badge" [ngClass]="getSubscriptionStatusClass(subscription)">{{ subscription.status | titlecase }}</span>
                  </div>
                  <div class="subscription-details">
                    <p><strong>Start Date:</strong> {{ subscription.startDate | date:'mediumDate' }}</p>
                    <p><strong>End Date:</strong> {{ subscription.endDate | date:'mediumDate' }}</p>
                    <p><strong>Days Remaining:</strong> {{ getDaysRemaining(subscription) }}</p>
                    <p><strong>Price:</strong> {{ subscription.price | currency }}</p>
                    <p><strong>Payment Status:</strong> 
                      <span class="payment-status" [ngClass]="subscription.paymentStatus">{{ subscription.paymentStatus | titlecase }}</span>
                    </p>
                    <p><strong>Auto Renew:</strong> {{ subscription.autoRenew ? 'Yes' : 'No' }}</p>
                  </div>
                  <div class="subscription-features">
                    <h6>Plan Features:</h6>
                    <ul>
                      <li>Max Products: {{ subscription.features.maxProducts }}</li>
                      <li>Max Images: {{ subscription.features.maxImages }}</li>
                      <li>Analytics: {{ subscription.features.analytics ? 'Yes' : 'No' }}</li>
                      <li>Priority Support: {{ subscription.features.prioritySupport ? 'Yes' : 'No' }}</li>
                      <li>Custom Branding: {{ subscription.features.customBranding ? 'Yes' : 'No' }}</li>
                      <li>API Access: {{ subscription.features.apiAccess ? 'Yes' : 'No' }}</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- User has no active subscription - show available plans -->
            <div *ngIf="!subscriptionLoading && !subscriptionError && !hasActiveSubscription" class="available-plans">
              <h4>Choose a Subscription Plan</h4>
              <p class="plans-description">Select a plan that best fits your business needs.</p>
              
              <div class="plans-grid">
                <div *ngFor="let plan of availablePlans" class="plan-card" [ngClass]="plan.type">
                  <div class="plan-header">
                    <h5 class="plan-name">{{ plan.name }}</h5>
                    <div class="plan-price">
                      <span class="price">{{ plan.price | currency }}</span>
                      <span class="duration">/ {{ plan.duration }} days</span>
                    </div>
                  </div>
                  <p class="plan-description">{{ plan.description }}</p>
                  <div class="plan-features">
                    <h6>Features:</h6>
                    <ul>
                      <li><mat-icon class="feature-icon">check</mat-icon>{{ plan.features.maxProducts }} Products</li>
                      <li><mat-icon class="feature-icon">check</mat-icon>{{ plan.features.maxImages }} Images per Product</li>
                      <li *ngIf="plan.features.analytics"><mat-icon class="feature-icon">check</mat-icon>Analytics Dashboard</li>
                      <li *ngIf="plan.features.prioritySupport"><mat-icon class="feature-icon">check</mat-icon>Priority Support</li>
                      <li *ngIf="plan.features.customBranding"><mat-icon class="feature-icon">check</mat-icon>Custom Branding</li>
                      <li *ngIf="plan.features.apiAccess"><mat-icon class="feature-icon">check</mat-icon>API Access</li>
                      <li *ngIf="plan.features.advancedReporting"><mat-icon class="feature-icon">check</mat-icon>Advanced Reporting</li>
                      <li *ngIf="plan.features.bulkOperations"><mat-icon class="feature-icon">check</mat-icon>Bulk Operations</li>
                      <li *ngIf="plan.features.whiteLabel"><mat-icon class="feature-icon">check</mat-icon>White Label</li>
                    </ul>
                  </div>
                  <button class="select-plan-btn" (click)="selectPlan(plan)">Select {{ plan.name }}</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Payment Modal -->
  <app-payment-modal
    [isVisible]="showPaymentModal"
    [selectedPlan]="selectedPlanForPayment"
    [supplierId]="getSupplierId()"
    (closeModal)="closePaymentModal()"
    (confirmPayment)="onPaymentConfirm($event)">
  </app-payment-modal>

